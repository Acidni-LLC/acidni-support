var AcidniSupport=function(n){"use strict";class t extends HTMLElement{static get observedAttributes(){return["app-id","api-url","position","user-email","user-name"]}constructor(){super(),this.config=null,this.isOpen=!1,this.apiUrl="",this.appId="",this.position="bottom-right",this.userEmail="",this.userName="",this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){this.appId=this.getAttribute("app-id")||"",this.apiUrl=this.getAttribute("api-url")||"https://apim-terprint-dev.azure-api.net/support/api",this.position=this.getAttribute("position")||"bottom-right",this.userEmail=this.getAttribute("user-email")||"",this.userName=this.getAttribute("user-name")||"",this.render(),this.loadConfig()}attributeChangedCallback(n,t,e){"app-id"===n&&(this.appId=e||""),"api-url"===n&&(this.apiUrl=e||""),"position"===n&&(this.position=e||"bottom-right"),"user-email"===n&&(this.userEmail=e||""),"user-name"===n&&(this.userName=e||"")}async loadConfig(){if(this.appId)try{const n=await fetch(`${this.apiUrl}/config/${this.appId}`);n.ok?(this.config=await n.json(),this.renderHome()):this.renderError("Could not load support configuration.")}catch(n){console.warn("[acidni-support] Failed to load config:",n),this.renderError("Could not connect to support service.")}}render(){const n="inline"===this.position;this.shadow.innerHTML=`\n      <style>\n  :host {\n    --primary: #2563eb;\n    --primary-hover: #1d4ed8;\n    --accent: #10b981;\n    --bg: #ffffff;\n    --bg-secondary: #f9fafb;\n    --text: #111827;\n    --text-secondary: #6b7280;\n    --border: #e5e7eb;\n    --radius: 12px;\n    --shadow: 0 10px 25px rgba(0,0,0,0.15);\n    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;\n    font-size: 14px;\n    color: var(--text);\n  }\n\n  /* â”€â”€ Floating Action Button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  .fab {\n    position: fixed;\n    z-index: 99999;\n    width: 56px;\n    height: 56px;\n    border-radius: 50%;\n    background: var(--primary);\n    color: white;\n    border: none;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: var(--shadow);\n    transition: transform 0.2s, background 0.2s;\n  }\n  .fab:hover { transform: scale(1.1); background: var(--primary-hover); }\n  .fab-bottom-right { bottom: 24px; right: 24px; }\n  .fab-bottom-left  { bottom: 24px; left: 24px; }\n\n  /* â”€â”€ Slide-out Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  .panel {\n    position: fixed;\n    z-index: 100000;\n    width: 380px;\n    max-width: calc(100vw - 32px);\n    max-height: 560px;\n    background: var(--bg);\n    border-radius: var(--radius);\n    box-shadow: var(--shadow);\n    display: none;\n    flex-direction: column;\n    overflow: hidden;\n    animation: slideIn 0.25s ease-out;\n  }\n  .panel.open { display: flex; }\n  .panel-inline {\n    position: relative !important;\n    display: flex !important;\n    width: 100%;\n    max-width: 520px;\n    max-height: none;\n    margin: 0 auto;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.12);\n  }\n  .panel-bottom-right { bottom: 92px; right: 24px; }\n  .panel-bottom-left  { bottom: 92px; left: 24px; }\n\n  @keyframes slideIn {\n    from { opacity: 0; transform: translateY(12px); }\n    to   { opacity: 1; transform: translateY(0); }\n  }\n\n  .panel-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--primary);\n    color: white;\n  }\n  .panel-title { font-weight: 600; font-size: 16px; }\n  .close-btn {\n    background: none;\n    border: none;\n    color: white;\n    font-size: 22px;\n    cursor: pointer;\n    padding: 0 4px;\n    line-height: 1;\n  }\n\n  .panel-body {\n    padding: 16px 20px;\n    overflow-y: auto;\n    flex: 1;\n  }\n\n  /* â”€â”€ Category Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  .categories {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n  }\n  .category-btn {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 14px 16px;\n    background: var(--bg-secondary);\n    border: 1px solid var(--border);\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 14px;\n    text-align: left;\n    transition: border-color 0.15s, background 0.15s;\n    color: var(--text);\n  }\n  .category-btn:hover {\n    border-color: var(--primary);\n    background: white;\n  }\n  .cat-icon { font-size: 20px; }\n  .cat-label { font-weight: 500; }\n\n  .loading {\n    text-align: center;\n    color: var(--text-secondary);\n    padding: 20px 0;\n  }\n  .error-msg {\n    text-align: center;\n    color: #dc2626;\n    padding: 16px 0;\n    font-size: 13px;\n  }\n  .empty-msg {\n    text-align: center;\n    color: var(--text-secondary);\n    padding: 24px 0;\n    font-size: 13px;\n  }\n\n  /* â”€â”€ Context Bar (app name, user greeting) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  .context-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 14px;\n    background: var(--bg-secondary);\n    border: 1px solid var(--border);\n    border-radius: 8px;\n    margin-bottom: 12px;\n    font-size: 13px;\n  }\n  .context-app { font-weight: 500; color: var(--text); }\n  .context-user { color: var(--primary); font-weight: 500; }\n  .context-cat {\n    color: var(--text-secondary);\n    font-style: italic;\n  }\n\n  /* â”€â”€ Past Requests Link â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  .past-requests-link {\n    margin-top: 14px;\n    padding-top: 12px;\n    border-top: 1px solid var(--border);\n    text-align: center;\n  }\n  .link-btn {\n    background: none;\n    border: none;\n    color: var(--primary);\n    cursor: pointer;\n    font-size: 13px;\n    font-weight: 500;\n    padding: 6px 12px;\n    border-radius: 6px;\n    transition: background 0.15s;\n  }\n  .link-btn:hover { background: var(--bg-secondary); }\n\n  /* â”€â”€ Past Requests List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  .past-requests {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n  }\n  .section-header {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n  }\n  .section-title {\n    font-weight: 600;\n    font-size: 15px;\n    color: var(--text);\n  }\n  .tickets-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  }\n  .ticket-row {\n    padding: 10px 14px;\n    border: 1px solid var(--border);\n    border-radius: 8px;\n    background: var(--bg-secondary);\n    transition: border-color 0.15s;\n  }\n  .ticket-row:hover { border-color: var(--primary); }\n  .ticket-main {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 4px;\n  }\n  .ticket-status { font-size: 14px; }\n  .ticket-subject {\n    font-weight: 500;\n    font-size: 13px;\n    color: var(--text);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n  .ticket-meta {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    font-size: 11px;\n    color: var(--text-secondary);\n  }\n  .ticket-id-label { font-family: monospace; }\n  .ticket-priority {\n    padding: 1px 6px;\n    border-radius: 4px;\n    font-weight: 500;\n  }\n  .ticket-priority.critical { background: #fef2f2; color: #dc2626; }\n  .ticket-priority.high { background: #fff7ed; color: #ea580c; }\n  .ticket-priority.normal { background: #f0f9ff; color: #2563eb; }\n  .ticket-priority.low { background: #f9fafb; color: #6b7280; }\n  .ticket-date { color: var(--text-secondary); }\n\n  /* â”€â”€ Form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  .support-form { display: flex; flex-direction: column; gap: 14px; }\n  .field { display: flex; flex-direction: column; gap: 4px; }\n  .field label {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-secondary);\n  }\n  .required { color: #dc2626; }\n  .field input,\n  .field textarea,\n  .field select {\n    padding: 10px 12px;\n    border: 1px solid var(--border);\n    border-radius: 6px;\n    font-size: 14px;\n    font-family: inherit;\n    background: white;\n    color: var(--text);\n    outline: none;\n    transition: border-color 0.15s;\n  }\n  .field input:focus,\n  .field textarea:focus,\n  .field select:focus {\n    border-color: var(--primary);\n  }\n  .field input.invalid,\n  .field textarea.invalid {\n    border-color: #dc2626;\n  }\n  .field-error {\n    font-size: 12px;\n    color: #dc2626;\n    min-height: 16px;\n  }\n  .field textarea { resize: vertical; min-height: 80px; }\n\n  .actions {\n    display: flex;\n    justify-content: space-between;\n    gap: 10px;\n    margin-top: 4px;\n  }\n  .btn-back {\n    background: none;\n    border: 1px solid var(--border);\n    border-radius: 6px;\n    padding: 10px 16px;\n    cursor: pointer;\n    font-size: 13px;\n    color: var(--text-secondary);\n  }\n  .btn-back:hover { background: var(--bg-secondary); }\n  .btn-submit {\n    background: var(--primary);\n    color: white;\n    border: none;\n    border-radius: 6px;\n    padding: 10px 24px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 500;\n    transition: background 0.15s;\n  }\n  .btn-submit:hover { background: var(--primary-hover); }\n  .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; }\n\n  .form-status { margin-top: 8px; }\n  .error { color: #dc2626; font-size: 13px; margin: 0; }\n\n  /* â”€â”€ Success State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  .success { text-align: center; padding: 20px 0; }\n  .success-icon { font-size: 48px; margin-bottom: 12px; }\n  .success h3 { margin: 0 0 8px; font-size: 18px; color: var(--text); }\n  .success p { margin: 4px 0; color: var(--text-secondary); font-size: 13px; }\n  .ticket-id { margin-top: 12px !important; font-size: 14px !important; color: var(--text) !important; }\n  .success .btn-submit { margin-top: 16px; }\n\n  /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  @media (max-width: 440px) {\n    .panel {\n      width: calc(100vw - 16px);\n      max-height: 80vh;\n      bottom: 8px !important;\n      right: 8px !important;\n      left: 8px !important;\n    }\n    .fab { bottom: 16px; right: 16px; }\n    .fab-bottom-left { left: 16px; }\n  }\n</style>\n      ${n?"":`<button class="fab fab-${this.position}" id="fab" aria-label="Get Support">\n              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>\n              </svg>\n            </button>`}\n      <div class="panel ${n?"panel-inline":`panel-${this.position}`}" id="panel" ${n?'style="display:block;position:relative;"':""}>\n        <div class="panel-header">\n          <span class="panel-title">Support</span>\n          ${n?"":'<button class="close-btn" id="close-btn" aria-label="Close">&times;</button>'}\n        </div>\n        <div class="panel-body" id="panel-body">\n          <div class="categories" id="categories">\n            <p class="loading">Loading...</p>\n          </div>\n        </div>\n      </div>\n    `;const t=this.shadow.getElementById("fab");t&&t.addEventListener("click",()=>this.toggle());const e=this.shadow.getElementById("close-btn");e&&e.addEventListener("click",()=>this.close())}renderError(n){const t=this.shadow.getElementById("categories");t&&(t.innerHTML=`<p class="error-msg">${n}</p>`)}renderHome(){const n=this.shadow.getElementById("panel-body");if(!n||!this.config)return;const t=this.config.app_name||this.appId,e=this.userName?`Hi ${this.userName}!`:"",i=this.config.categories.map(n=>`\n      <button class="category-btn" data-id="${n.id}">\n        <span class="cat-icon">${n.icon}</span>\n        <span class="cat-label">${n.label}</span>\n      </button>\n    `).join("");n.innerHTML=`\n      <div class="home-view">\n        <div class="context-bar">\n          <span class="context-app">ğŸ“± ${t}</span>\n          ${e?`<span class="context-user">${e}</span>`:""}\n        </div>\n        <div class="categories" id="categories">\n          ${i}\n        </div>\n        <div class="past-requests-link">\n          <button class="link-btn" id="view-requests-btn">ğŸ“‹ View my past requests</button>\n        </div>\n      </div>\n    `,n.querySelectorAll(".category-btn").forEach(n=>{n.addEventListener("click",()=>{const t=n.dataset.id;this.showForm(t)})});const s=this.shadow.getElementById("view-requests-btn");s&&s.addEventListener("click",()=>this.showPastRequests())}showForm(n){const t=this.shadow.getElementById("panel-body");if(!t)return;const e=this.config?.categories.find(t=>t.id===n)?.label||n;t.innerHTML=`\n      <form id="support-form" class="support-form" novalidate>\n        <input type="hidden" name="category" value="${n}" />\n\n        <div class="context-bar">\n          <span class="context-app">ğŸ“± ${this.config?.app_name||this.appId}</span>\n          <span class="context-cat">${e}</span>\n        </div>\n\n        <div class="field">\n          <label for="subject">Subject <span class="required">*</span></label>\n          <input type="text" id="subject" name="subject" required minlength="5" maxlength="200" placeholder="Brief summary of your issue" />\n          <span class="field-error" id="subject-error"></span>\n        </div>\n        <div class="field">\n          <label for="description">Description <span class="required">*</span></label>\n          <textarea id="description" name="description" required minlength="10" rows="4" maxlength="5000" placeholder="Please describe in detail..."></textarea>\n          <span class="field-error" id="description-error"></span>\n        </div>\n        <div class="field">\n          <label for="email">Your Email <span class="required">*</span></label>\n          <input type="email" id="email" name="email" required placeholder="you@example.com" value="${this.escapeAttr(this.userEmail)}" />\n          <span class="field-error" id="email-error"></span>\n        </div>\n        <div class="field">\n          <label for="priority">Priority</label>\n          <select id="priority" name="priority">\n            <option value="3">Normal</option>\n            <option value="2">High</option>\n            <option value="1">Critical</option>\n          </select>\n        </div>\n        <div class="actions">\n          <button type="button" class="btn-back" id="back-btn">â† Back</button>\n          <button type="submit" class="btn-submit">Submit</button>\n        </div>\n        <div id="form-status" class="form-status"></div>\n      </form>\n    `,this.shadow.getElementById("support-form").addEventListener("submit",n=>this.handleSubmit(n));const i=this.shadow.getElementById("back-btn");i&&i.addEventListener("click",()=>this.renderHome())}validateForm(n){let t=!0;const e=n.querySelector("#subject"),i=n.querySelector("#description"),s=n.querySelector("#email"),o=this.shadow.getElementById("subject-error"),a=this.shadow.getElementById("description-error"),r=this.shadow.getElementById("email-error");return[o,a,r].forEach(n=>{n&&(n.textContent="")}),[e,i,s].forEach(n=>n?.classList.remove("invalid")),(!e.value.trim()||e.value.trim().length<5)&&(o&&(o.textContent="Subject must be at least 5 characters."),e.classList.add("invalid"),t=!1),(!i.value.trim()||i.value.trim().length<10)&&(a&&(a.textContent="Description must be at least 10 characters."),i.classList.add("invalid"),t=!1),s.value.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.value.trim())||(r&&(r.textContent="Please enter a valid email address."),s.classList.add("invalid"),t=!1):(r&&(r.textContent="Email is required so we can follow up."),s.classList.add("invalid"),t=!1),t}async handleSubmit(n){n.preventDefault();const t=n.target,e=this.shadow.getElementById("form-status"),i=t.querySelector(".btn-submit");if(!this.validateForm(t))return;const s=new FormData(t);i.disabled=!0,i.textContent="Submitting...";const o={app_id:this.appId,category:s.get("category"),subject:s.get("subject"),description:s.get("description"),user_email:s.get("email")||void 0,user_name:this.userName||void 0,priority:parseInt(s.get("priority"))||3,context:{url:window.location.href,browser:navigator.userAgent,screen_resolution:`${window.screen.width}x${window.screen.height}`}};try{const n=await fetch(`${this.apiUrl}/submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(n.ok){const t=await n.json();this.showSuccess(t)}else{const t=await n.json().catch(()=>({detail:"Unknown error"})),s=this.formatErrorDetail(t.detail);e&&(e.innerHTML=`<p class="error">${s}</p>`),i.disabled=!1,i.textContent="Submit"}}catch(n){e&&(e.innerHTML='<p class="error">Network error. Please try again.</p>'),i.disabled=!1,i.textContent="Submit"}}formatErrorDetail(n){return"string"==typeof n?n:Array.isArray(n)?n.map(n=>`${n.loc?n.loc[n.loc.length-1]:"field"}: ${n.msg||"invalid"}`).join("; "):n&&"object"==typeof n?n.message||JSON.stringify(n):"An unexpected error occurred."}showSuccess(n){const t=this.shadow.getElementById("panel-body");if(!t)return;t.innerHTML=`\n      <div class="success">\n        <div class="success-icon">âœ…</div>\n        <h3>Submitted!</h3>\n        <p>${n.message}</p>\n        <p class="ticket-id">Ticket: <strong>${n.ticket_id}</strong></p>\n        <button class="btn-submit" id="done-btn">Done</button>\n      </div>\n    `;const e=this.shadow.getElementById("done-btn");e&&e.addEventListener("click",()=>{this.renderHome(),"inline"!==this.position&&this.close()})}async showPastRequests(){const n=this.shadow.getElementById("panel-body");if(!n)return;n.innerHTML='\n      <div class="past-requests">\n        <div class="section-header">\n          <button class="btn-back" id="back-btn">â† Back</button>\n          <span class="section-title">My Requests</span>\n        </div>\n        <div id="tickets-list" class="tickets-list">\n          <p class="loading">Loading requests...</p>\n        </div>\n      </div>\n    ';const t=this.shadow.getElementById("back-btn");t&&t.addEventListener("click",()=>this.renderHome());try{const n=new URLSearchParams;this.appId&&n.set("app_id",this.appId),this.userEmail&&n.set("email",this.userEmail),n.set("limit","25");const t=await fetch(`${this.apiUrl}/tickets?${n.toString()}`),e=t.ok?await t.json():[];this.renderTicketList(e)}catch(n){const t=this.shadow.getElementById("tickets-list");t&&(t.innerHTML='<p class="error-msg">Could not load tickets.</p>')}}renderTicketList(n){const t=this.shadow.getElementById("tickets-list");if(!t)return;if(0===n.length)return void(t.innerHTML='<p class="empty-msg">No past requests found.</p>');const e={created:"ğŸŸ¡","in-progress":"ğŸ”µ",resolved:"ğŸŸ¢",closed:"âš«"},i={1:"Critical",2:"High",3:"Normal",4:"Low"};t.innerHTML=n.map(n=>{const t=e[n.status]||"âšª",s=n.created_at?new Date(n.created_at).toLocaleDateString():"",o=i[n.priority]||"";return`\n          <div class="ticket-row">\n            <div class="ticket-main">\n              <span class="ticket-status">${t}</span>\n              <span class="ticket-subject">${this.escapeHtml(n.subject)}</span>\n            </div>\n            <div class="ticket-meta">\n              <span class="ticket-id-label">${n.ticket_id}</span>\n              <span class="ticket-priority ${o.toLowerCase()}">${o}</span>\n              <span class="ticket-date">${s}</span>\n            </div>\n          </div>\n        `}).join("")}escapeHtml(n){const t=document.createElement("div");return t.textContent=n,t.innerHTML}escapeAttr(n){return n.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}toggle(){this.isOpen?this.close():this.open()}open(){const n=this.shadow.getElementById("panel");n&&n.classList.add("open"),this.isOpen=!0}close(){const n=this.shadow.getElementById("panel");n&&n.classList.remove("open"),this.isOpen=!1}}return customElements.get("acidni-support")||customElements.define("acidni-support",t),n.AcidniSupportWidget=t,n}({});
