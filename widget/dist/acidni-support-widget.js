var AcidniSupport=function(n){"use strict";class t extends HTMLElement{static get observedAttributes(){return["app-id","api-url","position"]}constructor(){super(),this.config=null,this.isOpen=!1,this.apiUrl="",this.appId="",this.position="bottom-right",this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){this.appId=this.getAttribute("app-id")||"",this.apiUrl=this.getAttribute("api-url")||"https://apim-terprint-dev.azure-api.net/support",this.position=this.getAttribute("position")||"bottom-right",this.render(),this.loadConfig()}attributeChangedCallback(n,t,e){"app-id"===n&&(this.appId=e||""),"api-url"===n&&(this.apiUrl=e||""),"position"===n&&(this.position=e||"bottom-right")}async loadConfig(){if(this.appId)try{const n=await fetch(`${this.apiUrl}/config/${this.appId}`);n.ok&&(this.config=await n.json(),this.renderCategories())}catch(n){console.warn("[acidni-support] Failed to load config:",n)}}render(){const n="inline"===this.position;this.shadow.innerHTML=`\n      <style>\n  :host {\n    --primary: #2563eb;\n    --primary-hover: #1d4ed8;\n    --accent: #10b981;\n    --bg: #ffffff;\n    --bg-secondary: #f9fafb;\n    --text: #111827;\n    --text-secondary: #6b7280;\n    --border: #e5e7eb;\n    --radius: 12px;\n    --shadow: 0 10px 25px rgba(0,0,0,0.15);\n    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;\n    font-size: 14px;\n    color: var(--text);\n  }\n\n  /* ── Floating Action Button ─────────────────────────────────── */\n  .fab {\n    position: fixed;\n    z-index: 99999;\n    width: 56px;\n    height: 56px;\n    border-radius: 50%;\n    background: var(--primary);\n    color: white;\n    border: none;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: var(--shadow);\n    transition: transform 0.2s, background 0.2s;\n  }\n  .fab:hover { transform: scale(1.1); background: var(--primary-hover); }\n  .fab-bottom-right { bottom: 24px; right: 24px; }\n  .fab-bottom-left  { bottom: 24px; left: 24px; }\n\n  /* ── Slide-out Panel ────────────────────────────────────────── */\n  .panel {\n    position: fixed;\n    z-index: 100000;\n    width: 380px;\n    max-width: calc(100vw - 32px);\n    max-height: 560px;\n    background: var(--bg);\n    border-radius: var(--radius);\n    box-shadow: var(--shadow);\n    display: none;\n    flex-direction: column;\n    overflow: hidden;\n    animation: slideIn 0.25s ease-out;\n  }\n  .panel.open { display: flex; }\n  .panel-inline {\n    position: relative !important;\n    display: flex !important;\n    width: 100%;\n    max-width: 520px;\n    max-height: none;\n    margin: 0 auto;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.12);\n  }\n  .panel-bottom-right { bottom: 92px; right: 24px; }\n  .panel-bottom-left  { bottom: 92px; left: 24px; }\n\n  @keyframes slideIn {\n    from { opacity: 0; transform: translateY(12px); }\n    to   { opacity: 1; transform: translateY(0); }\n  }\n\n  .panel-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--primary);\n    color: white;\n  }\n  .panel-title { font-weight: 600; font-size: 16px; }\n  .close-btn {\n    background: none;\n    border: none;\n    color: white;\n    font-size: 22px;\n    cursor: pointer;\n    padding: 0 4px;\n    line-height: 1;\n  }\n\n  .panel-body {\n    padding: 16px 20px;\n    overflow-y: auto;\n    flex: 1;\n  }\n\n  /* ── Category Buttons ───────────────────────────────────────── */\n  .categories {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n  }\n  .category-btn {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 14px 16px;\n    background: var(--bg-secondary);\n    border: 1px solid var(--border);\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 14px;\n    text-align: left;\n    transition: border-color 0.15s, background 0.15s;\n    color: var(--text);\n  }\n  .category-btn:hover {\n    border-color: var(--primary);\n    background: white;\n  }\n  .cat-icon { font-size: 20px; }\n  .cat-label { font-weight: 500; }\n\n  .loading {\n    text-align: center;\n    color: var(--text-secondary);\n    padding: 20px 0;\n  }\n\n  /* ── Form ───────────────────────────────────────────────────── */\n  .support-form { display: flex; flex-direction: column; gap: 14px; }\n  .field { display: flex; flex-direction: column; gap: 4px; }\n  .field label {\n    font-size: 13px;\n    font-weight: 500;\n    color: var(--text-secondary);\n  }\n  .field input,\n  .field textarea,\n  .field select {\n    padding: 10px 12px;\n    border: 1px solid var(--border);\n    border-radius: 6px;\n    font-size: 14px;\n    font-family: inherit;\n    background: white;\n    color: var(--text);\n    outline: none;\n    transition: border-color 0.15s;\n  }\n  .field input:focus,\n  .field textarea:focus,\n  .field select:focus {\n    border-color: var(--primary);\n  }\n  .field textarea { resize: vertical; min-height: 80px; }\n\n  .actions {\n    display: flex;\n    justify-content: space-between;\n    gap: 10px;\n    margin-top: 4px;\n  }\n  .btn-back {\n    background: none;\n    border: 1px solid var(--border);\n    border-radius: 6px;\n    padding: 10px 16px;\n    cursor: pointer;\n    font-size: 13px;\n    color: var(--text-secondary);\n  }\n  .btn-back:hover { background: var(--bg-secondary); }\n  .btn-submit {\n    background: var(--primary);\n    color: white;\n    border: none;\n    border-radius: 6px;\n    padding: 10px 24px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 500;\n    transition: background 0.15s;\n  }\n  .btn-submit:hover { background: var(--primary-hover); }\n  .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; }\n\n  .form-status { margin-top: 8px; }\n  .error { color: #dc2626; font-size: 13px; margin: 0; }\n\n  /* ── Success State ──────────────────────────────────────────── */\n  .success { text-align: center; padding: 20px 0; }\n  .success-icon { font-size: 48px; margin-bottom: 12px; }\n  .success h3 { margin: 0 0 8px; font-size: 18px; color: var(--text); }\n  .success p { margin: 4px 0; color: var(--text-secondary); font-size: 13px; }\n  .ticket-id { margin-top: 12px !important; font-size: 14px !important; color: var(--text) !important; }\n  .success .btn-submit { margin-top: 16px; }\n\n  /* ── Responsive ─────────────────────────────────────────────── */\n  @media (max-width: 440px) {\n    .panel {\n      width: calc(100vw - 16px);\n      max-height: 80vh;\n      bottom: 8px !important;\n      right: 8px !important;\n      left: 8px !important;\n    }\n    .fab { bottom: 16px; right: 16px; }\n    .fab-bottom-left { left: 16px; }\n  }\n</style>\n      ${n?"":`<button class="fab fab-${this.position}" id="fab" aria-label="Get Support">\n              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>\n              </svg>\n            </button>`}\n      <div class="panel ${n?"panel-inline":`panel-${this.position}`}" id="panel" ${n?'style="display:block;position:relative;"':""}>\n        <div class="panel-header">\n          <span class="panel-title">Support</span>\n          ${n?"":'<button class="close-btn" id="close-btn" aria-label="Close">&times;</button>'}\n        </div>\n        <div class="panel-body" id="panel-body">\n          <div class="categories" id="categories">\n            <p class="loading">Loading...</p>\n          </div>\n        </div>\n      </div>\n    `;const t=this.shadow.getElementById("fab");t&&t.addEventListener("click",()=>this.toggle());const e=this.shadow.getElementById("close-btn");e&&e.addEventListener("click",()=>this.close())}renderCategories(){const n=this.shadow.getElementById("categories");if(!n||!this.config)return;const t=this.config.categories;n.innerHTML=t.map(n=>`\n      <button class="category-btn" data-id="${n.id}">\n        <span class="cat-icon">${n.icon}</span>\n        <span class="cat-label">${n.label}</span>\n      </button>\n    `).join(""),n.querySelectorAll(".category-btn").forEach(n=>{n.addEventListener("click",()=>{const t=n.dataset.id;this.showForm(t)})})}showForm(n){const t=this.shadow.getElementById("panel-body");if(!t)return;t.innerHTML=`\n      <form id="support-form" class="support-form">\n        <input type="hidden" name="category" value="${n}" />\n        <div class="field">\n          <label for="subject">Subject</label>\n          <input type="text" id="subject" name="subject" required maxlength="200" placeholder="Brief summary" />\n        </div>\n        <div class="field">\n          <label for="description">Description</label>\n          <textarea id="description" name="description" required rows="4" maxlength="5000" placeholder="Tell us more..."></textarea>\n        </div>\n        <div class="field">\n          <label for="email">Your Email (optional)</label>\n          <input type="email" id="email" name="email" placeholder="you@example.com" />\n        </div>\n        <div class="field">\n          <label for="priority">Priority</label>\n          <select id="priority" name="priority">\n            <option value="3">Normal</option>\n            <option value="2">High</option>\n            <option value="1">Critical</option>\n          </select>\n        </div>\n        <div class="actions">\n          <button type="button" class="btn-back" id="back-btn">← Back</button>\n          <button type="submit" class="btn-submit">Submit</button>\n        </div>\n        <div id="form-status" class="form-status"></div>\n      </form>\n    `,this.shadow.getElementById("support-form").addEventListener("submit",n=>this.handleSubmit(n));const e=this.shadow.getElementById("back-btn");e&&e.addEventListener("click",()=>{t.innerHTML='<div class="categories" id="categories"></div>',this.renderCategories()})}async handleSubmit(n){n.preventDefault();const t=n.target,e=this.shadow.getElementById("form-status"),i=t.querySelector(".btn-submit"),o=new FormData(t);i.disabled=!0,i.textContent="Submitting...";const a={app_id:this.appId,category:o.get("category"),subject:o.get("subject"),description:o.get("description"),user_email:o.get("email")||void 0,priority:parseInt(o.get("priority"))||3,context:{url:window.location.href,browser:navigator.userAgent,screen_resolution:`${window.screen.width}x${window.screen.height}`}};try{const n=await fetch(`${this.apiUrl}/submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(n.ok){const t=await n.json();this.showSuccess(t)}else{const t=await n.json().catch(()=>({}));e&&(e.innerHTML=`<p class="error">Failed: ${t.detail||"Unknown error"}</p>`),i.disabled=!1,i.textContent="Submit"}}catch(n){e&&(e.innerHTML='<p class="error">Network error. Please try again.</p>'),i.disabled=!1,i.textContent="Submit"}}showSuccess(n){const t=this.shadow.getElementById("panel-body");if(!t)return;t.innerHTML=`\n      <div class="success">\n        <div class="success-icon">✅</div>\n        <h3>Submitted!</h3>\n        <p>${n.message}</p>\n        <p class="ticket-id">Ticket: <strong>${n.ticket_id}</strong></p>\n        <button class="btn-submit" id="done-btn">Done</button>\n      </div>\n    `;const e=this.shadow.getElementById("done-btn");e&&e.addEventListener("click",()=>{const n=this.shadow.getElementById("panel-body");n&&(n.innerHTML='<div class="categories" id="categories"></div>',this.renderCategories()),"inline"!==this.position&&this.close()})}toggle(){this.isOpen?this.close():this.open()}open(){const n=this.shadow.getElementById("panel");n&&n.classList.add("open"),this.isOpen=!0}close(){const n=this.shadow.getElementById("panel");n&&n.classList.remove("open"),this.isOpen=!1}}return customElements.get("acidni-support")||customElements.define("acidni-support",t),n.AcidniSupportWidget=t,n}({});
